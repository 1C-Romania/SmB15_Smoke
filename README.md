Запуск дымовых тестов
======


Установка зависимостей
------

Для запуска полного цикла необходимо установить минимальный набор программ.
 * 1С 
 * [git](https://git-scm.com/)
 * [oscript](http://oscript.io/downloads) - текущая иснтрукция основана на develop версии 1.0.15 
 * [allure](https://github.com/allure-framework/allure-core/releases) - 1.4.23 (для allure дополнительно необходима java)
 * [nircmd](http://www.nirsoft.net/utils/nircmd.html) - для снятия скриншотов
 * [vanessa-behavior] - скачать и распаковать куда-либо, что-бы в дальнейшем указать этот путь. 

Особенности установки: 
git, oscript, allure, nircmd по результатам установки должны быть доступны из коммандной строки, т.е. запускаем cmd.exe и проверяем вывод комманд:
```
git --version
git version 2.6.2.windows.1

oscript  --version
1Script Execution Engine. Version 1.0.15.177

allure version
1.4.23
```

[Ссылки на инуструкции по установке переменных](
http://profhelp.com.ua/articles/%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%BD%D0%BE%D0%B9-%D0%BF%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D0%BE%D0%B9-%D0%BE%D0%BA%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F-path)

Допонительно при установке allure и java возможно понадобится установка переменно JAVA_HOME, если запускали EDT на компьютере, то думаю тут проблем не должно возникнуть. 

Запуск первоначальный
-----

Порядок запуска, прост и необходимо выполнить всего несколько шагов. 
* Необходимо перейти в каталог tools и отредкатировать файл init.bat(sh) и указать в переменну *storagesring* , точнее указать в строках storage-name свой путь к хранилищу, имя пользователя и пароль доступа к хранилищу
* потом запускаем данный init.bat и по результатам у нас должно создастья две папки в ./build - ib и ibservice, там будут файловые базы данных и обновленные на последнюю версию из хранилища.
> при этом дополнительно база ./build/ib будет вызвана для первоначальной инициализации, после инициализации необходимо будет закрыть вручную предприятие. 
* следующий шаг - запустить compile.bat для сборки внешних обработок в каталог ./build/out/
> в каталог ./build/out/features/ появятся внешние обработки и в ./build/out/epf
* открыть редактором vanessa.bat и отредкатировать переменную RUNNER_PATHVANESSA, там надо указать полный путь к vanessa-behavior
* запустить vanessa.bat, сейчас там для примера только одна фича "Пауза" и у вас должно все завершиться успешно. 

Запуск тестов повседневный
----

Как понимаете, для повседневного запуска, нам нет необходимости каждый раз запускать инициализацию конфигурации и т.д.
Для запуска нам достаточно формирировать правильные feature файлы в каталоге ./build/out/features, генерировать там обработки и потом запускать vanessa.bat
Если необходимо поменять настройки, то все они хранятся в json файле ./tools/.conf.json 

Генерация отчета
-----

Необходимо запустить cmd.exe и перейти в каталог ./build/allurereport, там выполнить комманды 
```
allure generate ./
```
будет генериться отчет allure (тут если не установили java или JAVA_HOME должны появится ошибки) и для открытия необходимо выполнить 
```
allure report open
``` 
в результате откроется браузер с готовым отчетом. 


**Генерация smoke тестов**
---

По пути ./build/out/epf/libraries/smoke.epf находится внешняя обработка которая сгенерит feature файлы для дымового открытия форм конфигурации сгруппировав их по верхним уровням подсистем.

Данную обработку необходимо открыть в режиме предприятия, там будет всего одна кнопка и необходимо ее нажать, потом выбрать каталог куда будут сохранятся feature файлы, например ./build/out/features/smoke и подождать, по результатам будут созданны feature файлы в данном каталоге.

Теперь можно запустить vanessa, перейти на вкладку библиотеки, проверить что каталог с ./build/out/epf/libraries подключен как библиотека, потом перейти на сам плеер (первая вкладка) и загрузить фичи из каталога и указываем ./build/out/features/smoke



